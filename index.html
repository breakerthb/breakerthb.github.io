<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Do not give up unless you die">
<meta property="og:type" content="website">
<meta property="og:title" content="天花板的个人博客">
<meta property="og:url" content="http://breakerthb.github.io/index.html">
<meta property="og:site_name" content="天花板的个人博客">
<meta property="og:description" content="Do not give up unless you die">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天花板的个人博客">
<meta name="twitter:description" content="Do not give up unless you die">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://breakerthb.github.io/"/>





  <title> 天花板的个人博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">天花板的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/BlogDemo.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/BlogDemo.html" itemprop="url">
                  博客模板
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T17:00:50+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/None/" itemprop="url" rel="index">
                    <span itemprop="name">None</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-发布新文章"><a href="#1-发布新文章" class="headerlink" title="1. 发布新文章"></a>1. 发布新文章</h1><pre><code>$ hexo new &quot;new article&quot;
</code></pre><p>之后在source/_posts目录下面，多了一个new-article.md的文件。打开之后修改：</p>
<pre><code>---
title: 新博客
date: 2017-03-11 16:56:50
tags:
    - blog
categories: None
---
</code></pre><p>修改后保存。之后执行并测试：</p>
<pre><code>$ hexo generate
$ hexo server -p 8080
</code></pre><p>发布：</p>
<pre><code>$ hexo g // 重新生成博客
$ hexo d // 发布
</code></pre><h1 id="2-图片"><a href="#2-图片" class="headerlink" title="2. 图片"></a>2. 图片</h1><p><img src="http://breakerthb.github.io/PIC/avatar.png" alt="天花板"></p>
<p>存储路径：source/PIC/avatar.png<br>显示路径：<a href="http://breakerthb.github.io/PIC/avatar.png">http://breakerthb.github.io/PIC/avatar.png</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/SqlHelperProcess.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/SqlHelperProcess.html" itemprop="url">
                  SqlHelper调用存储过程的方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:19:06+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ASP.NET中调用存储过程经常遇到这样那样的问题，特别是在有返回值参数的情况下。其实，并没有想象中的复杂。我们以之前博文中定义的存储过程为例。</p>
<p><a href="http://blog.sina.com.cn/s/blog_6849d1c201017mo7.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_6849d1c201017mo7.html</a></p>
<p>SqlHelper下载路径：<a href="http://www.kuaipan.cn/file/id_61213523170038890.htm" target="_blank" rel="external">http://www.kuaipan.cn/file/id_61213523170038890.htm</a></p>
<p>首先是定义链接字符串：</p>
<pre><code>// 连接字符串
string strConn = &quot;Initial Catalog=&apos;Students&apos;;Server=&apos;127.0.0.1,1433&apos;;User ID=&apos;sa&apos;;Password=&apos;XXXXXX&apos;;Persist Security Info=True&quot;;
// SQL 连接对象
SqlConnection Connection = new SqlConnection(strConn);
</code></pre><h1 id="一，插入新纪录存储过程"><a href="#一，插入新纪录存储过程" class="headerlink" title="一，插入新纪录存储过程"></a>一，插入新纪录存储过程</h1><pre><code>int ret = 0;
SqlParameter[] arParms = new SqlParameter[2];

// @Name Input Parameter
// NChar 类型需要指定Size
arParms[0] = new SqlParameter(&quot;@Name&quot;, SqlDbType.NChar, 50);
arParms[0].Value = &quot;HHEE&quot;;

// @NewID Output Parameter 
// 输出参数不需要赋值
arParms[1] = new SqlParameter(&quot;@NewID&quot;, SqlDbType.Int);
arParms[1].Direction = ParameterDirection.Output;

SqlHelper.ExecuteNonQuery(strConn, CommandType.StoredProcedure, &quot;proc_school_insert&quot;, arParms);

ret = Int32.Parse(arParms[1].Value.ToString());
</code></pre><h1 id="二，删除记录存储过程"><a href="#二，删除记录存储过程" class="headerlink" title="二，删除记录存储过程"></a>二，删除记录存储过程</h1><pre><code>SqlHelper.ExecuteNonQuery(strConn, CommandType.StoredProcedure, &quot;proc_school_del&quot;,
            new SqlParameter(&quot;@ID&quot;, 4));
</code></pre><h1 id="三，修改记录存储过程"><a href="#三，修改记录存储过程" class="headerlink" title="三，修改记录存储过程"></a>三，修改记录存储过程</h1><pre><code>SqlParameter[] para = { new SqlParameter(&quot;@ID&quot;, 5), 
                                new SqlParameter(&quot;@Name&quot;, &quot;1234&quot;) };
SqlHelper.ExecuteNonQuery(strConn, CommandType.StoredProcedure, &quot;proc_school_update&quot;,
            para);
</code></pre><h1 id="四，查询存储过程"><a href="#四，查询存储过程" class="headerlink" title="四，查询存储过程"></a>四，查询存储过程</h1><pre><code>SqlDataReader read = SqlHelper.ExecuteReader(strConn, CommandType.StoredProcedure, &quot;proc_school_select&quot;, new SqlParameter(&quot;@ID&quot;, 5));

while (read.Read())
{
    string str0 = read[0].ToString();
    string str1 = read[1].ToString();
}
</code></pre><p>PS：对于调用存储过程时参数的传递方法，其实比较灵活。有兴趣的可以自己多多实验。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/CSharpRadioButtonList.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/CSharpRadioButtonList.html" itemprop="url">
                  C# RadioButtonList控件（在线投票功能）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:17:53+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="涉及技术点："><a href="#涉及技术点：" class="headerlink" title="涉及技术点："></a>涉及技术点：</h1><ul>
<li><ol>
<li>RadioButtonList控件的使用</li>
</ol>
</li>
<li><ol>
<li>三层架构</li>
</ol>
</li>
<li><ol>
<li>ObjectDataSource绑定控件</li>
</ol>
</li>
<li><ol>
<li>触发器的使用</li>
</ol>
</li>
</ul>
<p>RadioButtonList实际上是RadioButton控件的一个容器，能够通过一个对象处理N个单选控件。<br>我们要建立一个能够随时更改投票内容的动态投票系统。维护人员能够通过简单的数据库修改发起一个新投票。在这个例子中，我们会有两个投票项目，可以动态切换。</p>
<h1 id="一，建立数据库"><a href="#一，建立数据库" class="headerlink" title="一，建立数据库"></a>一，建立数据库</h1><pre><code>create table TVote
(
Id int NOT NULL primary key,
Title nchar(100) NULL, 
TotleCnt int NULL, 
);

insert into TVote values(1,&apos;今天下班去哪儿吃饭?&apos;, 0);
insert into TVote values(2,&apos;先进员工评选&apos;, 0);

create table TVoteDetail
(
Id int IDENTITY(1,1) NOT NULL primary key, 
Detail nchar(100) NULL, 
VoteId int references TVote(Id), 
Cnt int NULL 
);

insert into TVoteDetail values(&apos;食堂&apos;,1,0);
insert into TVoteDetail values(&apos;小吃城&apos;,1,0);
insert into TVoteDetail values(&apos;快餐店&apos;,1,0);
insert into TVoteDetail values(&apos;大排档&apos;,1,0);
insert into TVoteDetail values(&apos;张三&apos;,2,0);
insert into TVoteDetail values(&apos;李四&apos;,2,0);
insert into TVoteDetail values(&apos;王五&apos;,2,0);
insert into TVoteDetail values(&apos;赵六&apos;,2,0);
</code></pre><p>我们总共建立了两张表，TVote作为主表，保存每个投票项目，TVoteDetail表保存投票的具体内容。<br>每当TVoteDetail中的得票数修改，TVote表中的全部票数也要跟着修改。这里用触发器来实现。脚本如下：<br>    if exists(select name from sysobjects where name=’TVoteDetail_Update’ and type=’tr’)<br>    drop trigger TVoteDetail_Update<br>    go<br>    create trigger TVoteDetail_Update<br>    on TVoteDetail<br>    for UPDATE<br>    as<br>    if(update(Cnt))<br>    begin<br>    declare @voteid int<br>    declare @totalcnt int<br>    select @voteid = VoteId from Inserted</p>
<pre><code>select @totalcnt = sum(cnt) from TVoteDetail 
where VoteId = @voteid
group by VoteId
update TVote set TotleCnt=@totalcnt where Id=@voteid
end
</code></pre><p>这样数据库部分完成。</p>
<h1 id="二，DAL层代码"><a href="#二，DAL层代码" class="headerlink" title="二，DAL层代码"></a>二，DAL层代码</h1><pre><code>///
/// 得到投票标题
///
/// 投票项ID
/// 投票项标题
public SqlDataReader GetVoteTitle(int nVoteID)
{
    string strConn = SqlHelper.GetConnSting();
    string strSQL = &quot;select Title from TVote where Id=&quot; + nVoteID.ToString();
    return SqlHelper.ExecuteReader(strConn, CommandType.Text, strSQL);
}

///
/// 得票数加1
///
/// 投票项目ID
public void UpdateVoteCnt(int nID)
{
    string strConn = SqlHelper.GetConnSting();
    string strSQL = &quot;update TVoteDetail set Cnt=Cnt+1 where Id=&quot; + nID;
    SqlHelper.ExecuteNonQuery(strConn, CommandType.Text, strSQL);
}
</code></pre><p>SQLHelper类的使用前面的本文已经介绍了，这里不再赘述。</p>
<h1 id="三，BLL代码"><a href="#三，BLL代码" class="headerlink" title="三，BLL代码"></a>三，BLL代码</h1><pre><code>[DataObjectMethod(DataObjectMethodType.Select)]
public static SqlDataReader GetVoteDetail(int nVoteID)
{
    DAL da = new DAL();
    return da.GetVoteDetail(nVoteID);
}
public static void UpdateVoteCnt(int nID)
{
    DAL da = new DAL();
    da.UpdateVoteCnt(nID);
}
</code></pre><h1 id="四，UI层"><a href="#四，UI层" class="headerlink" title="四，UI层"></a>四，UI层</h1><h2 id="1-在APSX页面中添加如下代码"><a href="#1-在APSX页面中添加如下代码" class="headerlink" title="1.在APSX页面中添加如下代码"></a>1.在APSX页面中添加如下代码</h2><pre><code>&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head runat=&quot;server&quot;&gt;
    &lt;title&gt;投票系统&lt;/title&gt;   
    &lt;style type=&quot;text/css&quot;&gt;
        .style1
        {
            width: 500px;
            margin:auto;
            border-style:solid;
            border-color:Black;
            border-width:1px;
        }
        .style2
        {
            height: 35px;
            background-color:#0066CC;
            color:White;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id=&quot;form1&quot; runat=&quot;server&quot;&gt;
    &lt;div style=&quot;width:100%; text-align:center;&quot;&gt;
        &lt;table class=&quot;style1&quot;&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;strong&gt;投票系统&lt;/strong&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    &lt;asp:Label ID=&quot;lblTitle&quot; runat=&quot;server&quot; Text=&quot;Label&quot;&gt;&lt;/asp:Label&gt;
                    &lt;asp:RadioButtonList ID=&quot;rblVote&quot; runat=&quot;server&quot; 
                        DataSourceID=&quot;ObjectDataSource1&quot; DataTextField=&quot;Detail&quot; DataValueField=&quot;Id&quot;&gt;
                    &lt;/asp:RadioButtonList&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:Button ID=&quot;btnSubmit&quot; runat=&quot;server&quot; onclick=&quot;btnSubmit_Click&quot; Text=&quot;提交&quot; /&gt;
&amp;nbsp;&lt;asp:Button ID=&quot;btnResult&quot; runat=&quot;server&quot; onclick=&quot;btnResult_Click&quot; Text=&quot;结果&quot; /&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
        &lt;asp:ObjectDataSource ID=&quot;ObjectDataSource1&quot; runat=&quot;server&quot; 
            DeleteMethod=&quot;Delete&quot; InsertMethod=&quot;Add&quot; 
            onselecting=&quot;ObjectDataSource1_Selecting&quot; SelectMethod=&quot;GetVoteDetail&quot; 
            TypeName=&quot;BLL&quot; UpdateMethod=&quot;Update&quot; 
            OldValuesParameterFormatString=&quot;original_{0}&quot;&gt;
            &lt;DeleteParameters&gt;
                &lt;asp:Parameter Name=&quot;nFavorID&quot; Type=&quot;Int32&quot; /&gt;
            &lt;/DeleteParameters&gt;
            &lt;InsertParameters&gt;
                &lt;asp:Parameter Name=&quot;strFavor&quot; Type=&quot;String&quot; /&gt;
            &lt;/InsertParameters&gt;
            &lt;SelectParameters&gt;
                &lt;asp:Parameter Name=&quot;nVoteID&quot; Type=&quot;Int32&quot; /&gt;
            &lt;/SelectParameters&gt;
            &lt;UpdateParameters&gt;
                &lt;asp:Parameter Name=&quot;nFavorID&quot; Type=&quot;Int32&quot; /&gt;
            &lt;/UpdateParameters&gt;
        &lt;/asp:ObjectDataSource&gt;
    &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="2-后台代码"><a href="#2-后台代码" class="headerlink" title="2.后台代码"></a>2.后台代码</h2><pre><code>public const int nVoteID = 2; // 设置投票ID

    protected void Page_Load(object sender, EventArgs e)
    {
        lblTitle.Text = BLL.GetVoteTitle(nVoteID);
    }

    protected void btnSubmit_Click1(object sender, EventArgs e)
    {
        int nID = Convert.ToInt32(rblVote.SelectedValue);

        BLL.UpdateVoteCnt(nID);
    }
    protected void btnLook_Click(object sender, EventArgs e)
    {

    }
    protected void ObjectDataSource1_Selecting(object sender, ObjectDataSourceSelectingEventArgs e)
    {
// ObjectDataSource 指定的是带有参数的select方法
        e.InputParameters[&quot;nVoteID&quot;] = nVoteID;  
    }
</code></pre><p>注意，ObjectDataSource控件需要指定BLL中的GetVoteDetail方法作为Select方法。<br>选择了需要投票的项目之后，提交。数据库中相应的项目会改变。自己试试吧。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/CSharpCheckBoxList.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/CSharpCheckBoxList.html" itemprop="url">
                  C# CheckBoxList控件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:16:55+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>单个的CheckBox控件对于一两个复选框的使用是比较方便的，然而，如果想要在一个页面中排放n个复选框，而且这些复选框的内容需要从数据库中动态获取时，CheckBoxList控件就非常有用。它能够通过控件数组的方法操作一系列的复选框。</p>
<p>下面介绍CheckBoxList控件的一些简单用法。</p>
<h1 id="1-与ObjectDataSource绑定"><a href="#1-与ObjectDataSource绑定" class="headerlink" title="1.与ObjectDataSource绑定"></a>1.与ObjectDataSource绑定</h1><h2 id="1）创建一个与数据库关联好的ObjectDataSource控件。如有问题请参考："><a href="#1）创建一个与数据库关联好的ObjectDataSource控件。如有问题请参考：" class="headerlink" title="1）创建一个与数据库关联好的ObjectDataSource控件。如有问题请参考："></a>1）创建一个与数据库关联好的ObjectDataSource控件。如有问题请参考：</h2><p> <a href="http://blog.sina.com.cn/s/blog_6849d1c201017ryg.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_6849d1c201017ryg.html</a></p>
<h2 id="2）为CheckListBox选择新数据源"><a href="#2）为CheckListBox选择新数据源" class="headerlink" title="2）为CheckListBox选择新数据源"></a>2）为CheckListBox选择新数据源</h2><p><img src="http://upload-images.jianshu.io/upload_images/145902-e143c24a765906d6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CheckBoxList控件"></p>
<h2 id="3）选择"><a href="#3）选择" class="headerlink" title="3）选择"></a>3）选择</h2><p><img src="http://upload-images.jianshu.io/upload_images/145902-0582b394e8ad890c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CheckBoxList控件"></p>
<p>数据源选择ObjectDataSource即可。后面两项一个是显示内容，一个是值内容（Value属性的值）。这两项都要填数据表中的字段。<br>这样就绑定成功了。</p>
<h1 id="2-添加项"><a href="#2-添加项" class="headerlink" title="2.添加项"></a>2.添加项</h1><pre><code>checkedListBox1.Items.Add(&quot;蓝色&quot;);
checkedListBox1.Items.Add(&quot;红色&quot;);
checkedListBox1.Items.Add(&quot;黄色&quot;);
</code></pre><h1 id="3-判断第i项是否选中-选中为true-否则为false"><a href="#3-判断第i项是否选中-选中为true-否则为false" class="headerlink" title="3.判断第i项是否选中,选中为true,否则为false"></a>3.判断第i项是否选中,选中为true,否则为false</h1><pre><code>if（checkedListBox1.GetItemChecked(i)）
{
    return true;
}
else
{
    return false;
}
</code></pre><h1 id="4-设置第i项是否选中"><a href="#4-设置第i项是否选中" class="headerlink" title="4.设置第i项是否选中"></a>4.设置第i项是否选中</h1><pre><code>checkedListBox1.SetItemChecked(i, true); //true改为false为没有选中。
checkedListBox1.SetItemCheckState(i, CheckState.Checked);
</code></pre><h1 id="5-设置全选"><a href="#5-设置全选" class="headerlink" title="5.设置全选"></a>5.设置全选</h1><pre><code>if(true)
{
    for (int j = 0; j &lt; checkedListBox1.Items.Count; j++)
        checkedListBox1.SetItemChecked(j, true);
}
else
{
    for (int j =0; j &lt; checkedListBox1.Items.Count; j++)
        checkedListBox1.SetItemChecked(j, false);
}
</code></pre><h1 id="6-得到全部选中的值-，并将选中的项的文本组合成为一个字符串。"><a href="#6-得到全部选中的值-，并将选中的项的文本组合成为一个字符串。" class="headerlink" title="6.得到全部选中的值 ，并将选中的项的文本组合成为一个字符串。"></a>6.得到全部选中的值 ，并将选中的项的文本组合成为一个字符串。</h1><pre><code>string strCollected = string.Empty;
for (int i = 0; i &lt; checkedListBox1.Items.Count; i++)
{
    if (checkedListBox1.GetItemChecked(i))
    {
        if (strCollected == string.Empty)
        {
            strCollected = checkedListBox1.GetItemText(checkedListBox1.Items[i]);
        }
        else
        {
            strCollected = strCollected + &quot;/&quot; + checkedListBox1.GetItemText(checkedListBox1.Items[i]);
         }
     }
}
</code></pre><h1 id="7-清除checkedListBox中所有的选项"><a href="#7-清除checkedListBox中所有的选项" class="headerlink" title="7.清除checkedListBox中所有的选项"></a>7.清除checkedListBox中所有的选项</h1><pre><code>for (int i = 0; i &lt; checkedListBox1.Items.Count; i++)
{
    checkedListBox1.Items.Clear();
}
</code></pre><h1 id="8-设置索引为index的项为选中状态"><a href="#8-设置索引为index的项为选中状态" class="headerlink" title="8.设置索引为index的项为选中状态"></a>8.设置索引为index的项为选中状态</h1><pre><code>for (int i = 0; i &lt; checkedListBox1.Items.Count; i++)
{
    checkedListBox1.SetItemChecked(i, true);
}
</code></pre><h1 id="9-选中checkedListBox1所有的选项"><a href="#9-选中checkedListBox1所有的选项" class="headerlink" title="9.选中checkedListBox1所有的选项"></a>9.选中checkedListBox1所有的选项</h1><pre><code>for (int i = 0; i &lt; checkedListBox1.Items.Count; i++)
{
    checkedListBox1.SetItemCheckState(i, CheckState.Checked);
}
</code></pre><h1 id="10-checkedListBox1中选定的项-gt-checkedListBox2"><a href="#10-checkedListBox1中选定的项-gt-checkedListBox2" class="headerlink" title="10.checkedListBox1中选定的项-&gt;checkedListBox2"></a>10.checkedListBox1中选定的项-&gt;checkedListBox2</h1><pre><code>for (int i = 0; i &lt; checkedListBox1.CheckedItems.Count; i++)
{
checkedListBox2.Items.Add(this.checkedListBox1.CheckedItems);

//remove是除去一个具体的值，不是index，注意了
checkedListBox1.Items.Remove(this.checkedListBox1.CheckedItems);
}
</code></pre><p>PS: CheckBoxList控件中的每个CheckBox的排列方法都可以通过属性界面进行调整，请参考：<br><a href="http://msdn.microsoft.com/zh-tw/library/wffkd2c9.aspx" target="_blank" rel="external">http://msdn.microsoft.com/zh-tw/library/wffkd2c9.aspx</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/CSharpListBox-DropDownList.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/CSharpListBox-DropDownList.html" itemprop="url">
                  ListBox&DropDownList控件（省、市选择）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:15:31+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="涉及技术点："><a href="#涉及技术点：" class="headerlink" title="涉及技术点："></a>涉及技术点：</h1><ul>
<li><ol>
<li>ListBox控件的用法</li>
</ol>
</li>
<li><ol>
<li>DropDownList控件的用法</li>
</ol>
</li>
<li><ol>
<li>控件联动</li>
</ol>
</li>
<li><ol>
<li>ObjectDataSource绑定控件后的数据刷新</li>
</ol>
</li>
<li><ol>
<li>给Select方法带参数的ObjectDataSource控件传参</li>
</ol>
</li>
</ul>
<p>在信息填写的表单中，常会需要填写省市之类的信息，如果能够选取会比较方便。这里就涉及一个控件联动的问题。下面我们就具体了解一下如何利用前面提到的技术设计这么一个从后台管理到前台应用的程序。</p>
<h1 id="一，数据库设计"><a href="#一，数据库设计" class="headerlink" title="一，数据库设计"></a>一，数据库设计</h1><p>需要两张表，一张保存省的名称，另一张保存市的名称。两张表是1：n的级联关系。下面是创建数据库脚本：</p>
<pre><code>create table TProvince
(
  Id int primary key identity,
  Name varchar(50) not null
)

create table TCity
(
  Id int primary key identity,
  Name varchar(50) not null,
  ProvinceId int references TProvince(Id)
)
</code></pre><p>在表中添加一条基本信息，用来初始显示。</p>
<pre><code>insert into TProvince values(&apos;北京&apos;)
insert into TCity values(&apos;北京&apos;, 1)
</code></pre><p>这样，数据库就建立好了。</p>
<h1 id="二，新建数据集"><a href="#二，新建数据集" class="headerlink" title="二，新建数据集"></a>二，新建数据集</h1><p>我们这次完全使用控件绑定来完成数据库的访问，以数据集为基础。<br>1.新建一个数据集（DataSet）,命名为DSProvinceCity.xsd<br>2.从工具箱中添加两个TableAdapter，分别与 TProvince 和 TCity 表关联。具体方法之前的日志已经讲过。添加后，会生成两个DataTable对象（TProvice和TCity）还有两个TableAdapter对象(TProvinceTableAdapter和TCityAdaper)。如图所示。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-195631dbbbafbbe3?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ListBox&amp;DropDownList控件（省、市选择）"></p>
<h1 id="三，UI设计"><a href="#三，UI设计" class="headerlink" title="三，UI设计"></a>三，UI设计</h1><p>页面分为两部分，后台管理部分和前台应用部分。<br>后台管理部分：用于帮助管理员上传各个省、市名称和对应关系的数据<br>前台应用部分：用户上传数据时使用</p>
<h1 id="四，后台管理部分（ListBox联动）"><a href="#四，后台管理部分（ListBox联动）" class="headerlink" title="四，后台管理部分（ListBox联动）"></a>四，后台管理部分（ListBox联动）</h1><p>1.在页面中添加两个ListBox控件，分别命名为lbProvince和lbCity<br>2.添加一个ObjectDataSource控件，命名为ODSProvince，配置数据源<br>3.选择业务对象</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-699fad3cf510beb0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ListBox&amp;DropDownList控件（省、市选择）"></p>
<p>4.重复2、3添加另一个ObjectDataSource控件（ODSCity）。并配置数据源<br>5.为lbProvince选择数据源</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-d44522b13fcded85?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ListBox&amp;DropDownList控件（省、市选择）"></p>
<p>6.为lbCity选择数据源</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-4efed013f80c2c11?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="http://s9.sinaimg.cn/large/6849d1c2g0a4382bbc698&amp;690"></p>
<p>运行一下看看是否能够正常显示数据。下面我们看看如何设计一个添加“省”的功能。<br>7.在页面上添加一个TextBox控件，命名为txtProvinceAdd。再添加一个Button，命名为btnProvinceAdd。并添加如下代码：</p>
<pre><code>protected void btnProvinceAdd_Click(object sender, EventArgs e)
{
    TProvinceTableAdapter province = new TProvinceTableAdapter();
    province.Insert(txtProvinceAdd.Text.ToString().Trim());
    txtProvinceAdd.Text = &quot;&quot;;
    lbProvince.DataBind(); // 重新绑定数据源
}
</code></pre><p>给没有引用的命名空间加入using语句，这里可以用VS中的自动添加功能。这样我们就能通过TProvinceTableAdapter 提供的方法将新的省名写进数据库了。<br>lbProvince.DataBind();<br>这句话很重要，如果没有它，添加了省名的lbProvince控件不会有任何变化。重新绑定后能实现数据的刷新。<br>运行一下程序，添加几个省。</p>
<p>8.重复7的动作，添加txtCityAdd和btnCityAdd。并添加如下代码：</p>
<pre><code>protected void btnCityAdd_Click(object sender, EventArgs e)
{
    TCityTableAdapter city = new TCityTableAdapter();
    city.Insert(txtCityAdd.Text.ToString().Trim(), Convert.ToInt16(lbProvince.SelectedValue));
    txtCityAdd.Text = &quot;&quot;;
    lbCity.DataBind();
}
</code></pre><p>由于市名需要和省名进行关联，因此我们在添加市之前要先选择一个省名，lbProvince控件获得焦点后，lbProvince.SelectedValue语句能够得到选中省名的ID号。<br>为两个ListBox添加初始焦点位置，代码如下：</p>
<pre><code>protected void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack) // 只有第一次加载时付初值
    {
        lbProvince.SelectedIndex = 0;
        lbCity.SelectedIndex = 0;
    }
}
</code></pre><p>运行一下程序，给某个省添加几个市吧。<br>貌似有点问题，好像添加之后省和市并不对应。那是因为两个控件的联动没有做好。</p>
<p>9.将lbProvince控件的AutoPostBack属性设为True,并添加点击事件。代码如下：</p>
<pre><code>protected void lbProvince_SelectedIndexChanged(object sender, EventArgs e)
{
    lbCity.DataBind();
}
</code></pre><p>10.修改TCityTableAdapter的Select方法</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-2e150dd4f5687713?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ListBox&amp;DropDownList控件（省、市选择）"></p>
<p>在DataSet数据集界面中，选择TCityTableAdapter,在它的SelectCommand子属性中，选择CommandText。弹出查询生成器。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-9b4652f912fbefb6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ListBox&amp;DropDownList控件（省、市选择）"></p>
<p>在SQL语句中添加“where ProvinceId=@ProvinceId”语句。<br>这是，运行程序会报错，因为ODSCity控件没有给TCityTableAdapter传参。</p>
<p>11.修改ODSCity</p>
<p>双击ODSCity控件，添加如下代码：</p>
<pre><code>protected void ODSCity_Selecting(object sender, ObjectDataSourceSelectingEventArgs e)
{
    e.InputParameters[&quot;ProvinceId&quot;] = lbProvince.SelectedValue; // 传参方法
}
</code></pre><p>这下再运行试试。是不是一切都对了。<br>如果需要添加删除方法，可以继续下面的步骤。</p>
<p>12.添加两个Button，分别命名为btnProvinceDel和btnCityDel。实现代码如下：</p>
<pre><code>protected void btnProvinceDel_Click(object sender, EventArgs e)
{
    int nProvinceID = Convert.ToInt16(lbProvince.SelectedValue);

    TCityTableAdapter city = new TCityTableAdapter();
    DSProvinceCity.TCityDataTable cityTable = city.GetCityData(nProvinceID);

    if (cityTable.Rows.Count &gt; 0)
    {
        Response.Write(&quot;&lt;script type=&quot;text/javascript&quot;&gt;alert(&apos;这个省不能删除!&apos;);&lt;/script&gt;&quot;);
    }
    else
    {
        TProvinceTableAdapter province = new TProvinceTableAdapter();
        province.Delete(nProvinceID);
    }
}
protected void btnCityDel_Click(object sender, EventArgs e)
{
    TCityTableAdapter city = new TCityTableAdapter();
    city.Delete(Convert.ToInt16(lbCity.SelectedValue));

    lbCity.DataBind();
}
</code></pre><p>由于省表的ID是市表的外键，因此在删除省中的记录时要先判断是否已经将级联关系删除完全。</p>
<p>这样，后台管理程序就OK了。</p>
<h1 id="五，前台管理程序"><a href="#五，前台管理程序" class="headerlink" title="五，前台管理程序"></a>五，前台管理程序</h1><p>1.在页面中添加两个DropDownList控件，分别命名为ddlProvince和ddlCity<br>2.创建一个新ObjectDataSource控件，命名为ODSCityAnother与TCityTableAdaper关联<br>3.与ListBox控件类似，让ddlProvince控件与ODSProvince控件绑定，让ddlCity控件与ODSCityAnother控件绑定<br>4.双击ODSCityAnother控件，添加代码如下：</p>
<pre><code>protected void ODSCityAnother_Selecting(object sender, ObjectDataSourceSelectingEventArgs e)
{
    e.InputParameters[&quot;ProvinceId&quot;] = ddlProvince.SelectedValue; 
}
</code></pre><p>5.双击ddlProvince控件，添加代码如下：</p>
<pre><code>protected void ddlProvince_SelectedIndexChanged(object sender, EventArgs e)
{
    ddlCity.DataBind();
}
</code></pre><p>6.ddlProvince控件AutoPostBack属性设为True</p>
<p>运行一下，感受前台程序的体验吧。是不是很爽啊，哈哈~</p>
<h1 id="附录："><a href="#附录：" class="headerlink" title="附录："></a>附录：</h1><p>ASPX页面代码：</p>
<pre><code>&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head id=&quot;Head1&quot; runat=&quot;server&quot;&gt;
    &lt;title&gt;ProvinceCity&lt;/title&gt;
    &lt;style type=&quot;text/css&quot;&gt;
        .style1
        {
            width: 500;
            border-width:1px;
            border-style:solid;
            border-color:Black;
            margin:auto;
        }
        .Title
        {
            width:204px;
            background-color:Blue;
            color:White;
        }
        .style2
        {
            width: 204px;
            border-width:1px;
            border-style:solid;
            border-color:Black;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id=&quot;form1&quot; runat=&quot;server&quot;&gt;

    &lt;div style=&quot; width:100%; text-align:center;&quot;&gt;
        &lt;div style=&quot;height:30px;&quot;&gt;后台管理程序&lt;/div&gt;
        &lt;table class=&quot;style1&quot;&gt;
            &lt;tr&gt;
                &lt;td class=&quot;Title&quot;&gt;
                    省&lt;/td&gt;
                &lt;td class=&quot;Title&quot;&gt;
                    市&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:ListBox ID=&quot;lbProvince&quot; runat=&quot;server&quot;  
                        DataSourceID=&quot;ODSProvince&quot; DataTextField=&quot;Name&quot; DataValueField=&quot;Id&quot; 
                        Height=&quot;220px&quot; 
                        Width=&quot;200px&quot; onselectedindexchanged=&quot;lbProvince_SelectedIndexChanged&quot;&gt;&lt;/asp:ListBox&gt;
                &lt;/td&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:ListBox ID=&quot;lbCity&quot; runat=&quot;server&quot; DataSourceID=&quot;ODSCity&quot; 
                        DataTextField=&quot;Name&quot; DataValueField=&quot;Id&quot; Height=&quot;220px&quot; Width=&quot;200px&quot;&gt;
                    &lt;/asp:ListBox&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:Button ID=&quot;btnProvinceDel&quot; runat=&quot;server&quot;  
                        Text=&quot;删除&quot; onclick=&quot;btnProvinceDel_Click&quot; /&gt;
                &lt;/td&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:Button ID=&quot;btnCityDel&quot; runat=&quot;server&quot; Text=&quot;删除&quot; onclick=&quot;btnCityDel_Click&quot; 
                         /&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:TextBox ID=&quot;txtProvinceAdd&quot; runat=&quot;server&quot;&gt;&lt;/asp:TextBox&gt;
                    &lt;asp:Button ID=&quot;btnProvinceAdd&quot; runat=&quot;server&quot; Text=&quot;添加&quot; 
                        onclick=&quot;btnProvinceAdd_Click&quot; /&gt;
                &lt;/td&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:TextBox ID=&quot;txtCityAdd&quot; runat=&quot;server&quot;&gt;&lt;/asp:TextBox&gt;
                    &lt;asp:Button ID=&quot;btnCityAdd&quot; runat=&quot;server&quot; Text=&quot;添加&quot; 
                        onclick=&quot;btnCityAdd_Click&quot; /&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &amp;nbsp;&lt;/td&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &amp;nbsp;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/div&gt;

    &lt;asp:ObjectDataSource ID=&quot;ODSProvince&quot; runat=&quot;server&quot; DeleteMethod=&quot;Delete&quot; 
        InsertMethod=&quot;Insert&quot; OldValuesParameterFormatString=&quot;original_{0}&quot; 
        SelectMethod=&quot;GetProvinceData&quot; 
        TypeName=&quot;DSProvinceCityTableAdapters.TProvinceTableAdapter&quot; 
        UpdateMethod=&quot;Update&quot;&gt;
        &lt;DeleteParameters&gt;
            &lt;asp:Parameter Name=&quot;Original_Id&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/DeleteParameters&gt;
        &lt;InsertParameters&gt;
            &lt;asp:Parameter Name=&quot;Name&quot; Type=&quot;String&quot; /&gt;
        &lt;/InsertParameters&gt;
        &lt;UpdateParameters&gt;
            &lt;asp:Parameter Name=&quot;Name&quot; Type=&quot;String&quot; /&gt;
            &lt;asp:Parameter Name=&quot;Original_Id&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/UpdateParameters&gt;
    &lt;/asp:ObjectDataSource&gt;
    &lt;asp:ObjectDataSource ID=&quot;ODSCity&quot; runat=&quot;server&quot; DeleteMethod=&quot;Delete&quot; 
        InsertMethod=&quot;Insert&quot; OldValuesParameterFormatString=&quot;original_{0}&quot; 
        SelectMethod=&quot;GetCityData&quot; 
        TypeName=&quot;DSProvinceCityTableAdapters.TCityTableAdapter&quot; 
        UpdateMethod=&quot;Update&quot; onselecting=&quot;ODSCity_Selecting&quot;&gt;
        &lt;DeleteParameters&gt;
            &lt;asp:Parameter Name=&quot;Original_Id&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/DeleteParameters&gt;
        &lt;InsertParameters&gt;
            &lt;asp:Parameter Name=&quot;Name&quot; Type=&quot;String&quot; /&gt;
            &lt;asp:Parameter Name=&quot;ProvinceId&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/InsertParameters&gt;
        &lt;UpdateParameters&gt;
            &lt;asp:Parameter Name=&quot;Name&quot; Type=&quot;String&quot; /&gt;
            &lt;asp:Parameter Name=&quot;ProvinceId&quot; Type=&quot;Int32&quot; /&gt;
            &lt;asp:Parameter Name=&quot;Original_Id&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/UpdateParameters&gt;
    &lt;/asp:ObjectDataSource&gt;
    &lt;hr/&gt;

    &lt;div style=&quot; width:100%; text-align:center;&quot;&gt;
        &lt;div style=&quot;height:30px;&quot;&gt;前台应用程序&lt;/div&gt;
         &lt;table class=&quot;style1&quot;&gt;
            &lt;tr&gt;
                &lt;td class=&quot;Title&quot;&gt;
                    省&lt;/td&gt;
                &lt;td class=&quot;Title&quot;&gt;
                    市&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:DropDownList ID=&quot;ddlProvince&quot; runat=&quot;server&quot;  
                        DataSourceID=&quot;ODSProvince&quot; DataTextField=&quot;Name&quot; DataValueField=&quot;Id&quot; onselectedindexchanged=&quot;ddlProvince_SelectedIndexChanged&quot; 
                        &gt;
                    &lt;/asp:DropDownList&gt;
                &lt;/td&gt;
                &lt;td class=&quot;style2&quot;&gt;
                    &lt;asp:DropDownList ID=&quot;ddlCity&quot; runat=&quot;server&quot; DataSourceID=&quot;ODSCityAnother&quot; 
                        DataTextField=&quot;Name&quot; DataValueField=&quot;Id&quot;&gt;
                    &lt;/asp:DropDownList&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
          &lt;/table&gt;
    &lt;/div&gt;

    &lt;asp:ObjectDataSource ID=&quot;ODSCityAnother&quot; runat=&quot;server&quot; DeleteMethod=&quot;Delete&quot; 
        InsertMethod=&quot;Insert&quot; OldValuesParameterFormatString=&quot;original_{0}&quot; 
        onselecting=&quot;ODSCityAnother_Selecting&quot; SelectMethod=&quot;GetCityData&quot; 
        TypeName=&quot;DSProvinceCityTableAdapters.TCityTableAdapter&quot; UpdateMethod=&quot;Update&quot;&gt;
        &lt;DeleteParameters&gt;
            &lt;asp:Parameter Name=&quot;Original_Id&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/DeleteParameters&gt;
        &lt;InsertParameters&gt;
            &lt;asp:Parameter Name=&quot;Name&quot; Type=&quot;String&quot; /&gt;
            &lt;asp:Parameter Name=&quot;ProvinceId&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/InsertParameters&gt;
        &lt;SelectParameters&gt;
            &lt;asp:Parameter Name=&quot;ProvinceId&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/SelectParameters&gt;
        &lt;UpdateParameters&gt;
            &lt;asp:Parameter Name=&quot;Name&quot; Type=&quot;String&quot; /&gt;
            &lt;asp:Parameter Name=&quot;ProvinceId&quot; Type=&quot;Int32&quot; /&gt;
            &lt;asp:Parameter Name=&quot;Original_Id&quot; Type=&quot;Int32&quot; /&gt;
        &lt;/UpdateParameters&gt;
    &lt;/asp:ObjectDataSource&gt;
    &lt;hr/&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/ObjectDataSource-2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/ObjectDataSource-2.html" itemprop="url">
                  ObjectDataSource数据源控件（2）自动实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:14:10+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nome/" itemprop="url" rel="index">
                    <span itemprop="name">Nome</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ObjectDataSource可在多个页面中重复使用，这点和SqlDataSource不同。</p>
<p>我们可以通过VS向导自动创建访问数据库的类，这样就可以省去（1）中提到的自行定义BLL层接口的动作。</p>
<p>设置步骤如下：</p>
<h1 id="一，TableAdapter控件"><a href="#一，TableAdapter控件" class="headerlink" title="一，TableAdapter控件"></a>一，TableAdapter控件</h1><p>1.“添加新项”中选择“数据集”</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-eae44f2c4c6bd344?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>之后点击添加按钮。</p>
<p>2.打开该数据集的设计界面，在工具箱中拖入TableAdapter控件</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-32ad87184012e6e0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>3.接着会自动弹出“TableAdapter配置向导”，选择连接字符串，点“下一步”<br>注意：若没有现成的数据链接供选择，可以点击“新建连接”按钮通过新建向导来创建。这里不具体介绍了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-8dea8f15681442f8?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>4.选择”使用SQL语句”，点“下一步”</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-5e2f8db1e8dfea01?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>5.点击“选择查询生成器”-&gt; 选择表 -&gt; 所有列(*) -&gt; 点击“确定”</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-3bc4b58fe0bbbefe?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>6.点击“高级选项” -&gt; “生成Insert，Update，Delete语句” -&gt; “确定”</p>
<p><img src="http://upload-images.jianshu.io/upload_images/145902-bdc0e19383c96926?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>7.完成<br>重新编译一下网站。</p>
<h1 id="二，验证ObjectDataSource"><a href="#二，验证ObjectDataSource" class="headerlink" title="二，验证ObjectDataSource"></a>二，验证ObjectDataSource</h1><p>1.新建网页ObjectDataSourceDemo.aspx -&gt; 把ObjectDataSource拖入设计界面 -&gt; 配置数据源 -&gt; 选择业务对象（刚刚建的DataSet类） -&gt; 下一步 -&gt; 完成</p>
<p>2.拖入GridView控件 -&gt; 选择数据源 -&gt;ObjectDataSource1</p>
<p>表中的数据就能在GrideView控件中正确显示了。</p>
<p><img src="http://s3.sinaimg.cn/mw690/6849d1c2g0a031d779442&amp;690" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>4.选择”使用SQL语句”，点“下一步”</p>
<p><img src="http://s7.sinaimg.cn/mw690/6849d1c2gdcd1d29b78d6&amp;690" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>5.点击“选择查询生成器”-&gt; 选择表 -&gt; 所有列(*) -&gt; 点击“确定”</p>
<p><img src="http://s11.sinaimg.cn/mw690/6849d1c2gdcd1e351f53a&amp;690" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>6.点击“高级选项” -&gt; “生成Insert，Update，Delete语句” -&gt; “确定”</p>
<p><img src="http://s6.sinaimg.cn/mw690/6849d1c2gdcd1ed970d85&amp;690" alt="ObjectDataSource数据源控件（2）自动实现"></p>
<p>7.完成<br>重新编译一下网站。</p>
<h1 id="二，验证ObjectDataSource-1"><a href="#二，验证ObjectDataSource-1" class="headerlink" title="二，验证ObjectDataSource"></a>二，验证ObjectDataSource</h1><p>1.新建网页ObjectDataSourceDemo.aspx -&gt; 把ObjectDataSource拖入设计界面 -&gt; 配置数据源 -&gt; 选择业务对象（刚刚建的DataSet类） -&gt; 下一步 -&gt; 完成</p>
<p>2.拖入GridView控件 -&gt; 选择数据源 -&gt;ObjectDataSource1</p>
<p>表中的数据就能在GrideView控件中正确显示了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/ObjectDataSource-1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/ObjectDataSource-1.html" itemprop="url">
                  ObjectDataSource数据源控件（1）手动实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:13:13+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ASP.NET中，数据源控件是所有显示控件和数据库绑定的媒介，因此相当重要。数据源控件实际上是帮助绑定动作完成数据库的增、删、改、查功能。<br>与SqlDataSource相比，ObjectDataSource更适用于三层架构（UI、BLL、DAL）的开发。用户可以自行定义访问数据库接口。<br>ObjectDataSource控件实际上是通过一个BLL层类完成对某一个特定数据库的操作。</p>
<h1 id="1-建立三层架构"><a href="#1-建立三层架构" class="headerlink" title="1.建立三层架构"></a>1.建立三层架构</h1><p>这里，我们用DAL和BLL两个类来代表这两个层。至于UI层，自然是ASPX页面了。</p>
<h1 id="2-BLL层"><a href="#2-BLL层" class="headerlink" title="2.BLL层"></a>2.BLL层</h1><pre><code>public class BLL{
 [DataObjectMethod(DataObjectMethodType.Insert)]
    public static int Add(string strInfo)
    {
      DAL da = new DAL();
      return da.Add(strInfo);
    }

    [DataObjectMethod(DataObjectMethodType.Delete)]
    public static void Delete(int nID)
    {
      DAL da = new DAL();
      da.Delete(nID)
    }

    [DataObjectMethod(DataObjectMethodType.Update)]
    public static void Update(int nID, string strInfo)
    {
      DAL da = new DAL();
      da.Update(nID, strInfo);
    }

    [DataObjectMethod(DataObjectMethodType.Select)]
    public static SqlDataReader GetAll()
    {
        DAL da = new DAL();
        return da.GetAll();
    }
}
</code></pre><p>注意：中括号里的语句用了声明这四个函数的意义，方便后面绑定控件时指定相关方法。</p>
<h1 id="3-DAL层"><a href="#3-DAL层" class="headerlink" title="3.DAL层"></a>3.DAL层</h1><pre><code>public class DAL{
    public int Add(string strInfo)
    {
      // 连接Database, 调用Insert语句
    }

    public void Delete(int nID)
    {
      // 连接Database, 调用Delete语句
    }

    public void Update(int nID, string strInfo)
    {
      // 连接Database, 调用update语句
    }

    public SqlDataReader GetAll()
    {
      // 连接Database, 调用select语句
    }
}
</code></pre><h1 id="4-绑定ObjectDataSource控件"><a href="#4-绑定ObjectDataSource控件" class="headerlink" title="4.绑定ObjectDataSource控件"></a>4.绑定ObjectDataSource控件</h1><h2 id="1-从工具箱中拖拽一个ObjectDataSource控件到需要的ASPX页面中"><a href="#1-从工具箱中拖拽一个ObjectDataSource控件到需要的ASPX页面中" class="headerlink" title="1) 从工具箱中拖拽一个ObjectDataSource控件到需要的ASPX页面中"></a>1) 从工具箱中拖拽一个ObjectDataSource控件到需要的ASPX页面中</h2><h2 id="2-配置数据源"><a href="#2-配置数据源" class="headerlink" title="2)配置数据源"></a>2)配置数据源</h2><p><img src="http://upload-images.jianshu.io/upload_images/145902-19523683853a78ca?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件"></p>
<h2 id="3）选择业务对象：BLL类"><a href="#3）选择业务对象：BLL类" class="headerlink" title="3）选择业务对象：BLL类"></a>3）选择业务对象：BLL类</h2><p><img src="http://upload-images.jianshu.io/upload_images/145902-747944ec56309e7d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件"></p>
<p>下一步</p>
<h2 id="4）定义数据方法"><a href="#4）定义数据方法" class="headerlink" title="4）定义数据方法"></a>4）定义数据方法</h2><p><img src="http://upload-images.jianshu.io/upload_images/145902-5023cad227dd544a?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ObjectDataSource数据源控件"></p>
<p>分别给增删改查方法指定BLL类中的方法。</p>
<p>点击“完成”。这样一个ObjectDataSource控件就定义完成了，之后可以使用它为其他控件提供数据服务。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/SqlHelperOperate.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/SqlHelperOperate.html" itemprop="url">
                  SqlHelper.cs使用方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:09:56+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>传说中，微软有一个专为.NET提供的数据库访问类。之前也见过很多版本，大多是经过网友修改过的。我在官网上貌似也没找到专门的下载链接，应该是从PetShop一类的Demo工程中得到的。于是过来发一个能找到的相对原汁原味的版本，仅供参考。<br>下载路径：<a href="http://www.kuaipan.cn/file/id_61213523170038890.htm" target="_blank" rel="external">http://www.kuaipan.cn/file/id_61213523170038890.htm</a><br>带中文注释的版本网上也有很多，有兴趣的可以自己下载。</p>
<p>下面说说如何使用这个类进行简单的增删改查。我们依然使用之前案例中创建的数据库进行实验。<br><a href="http://blog.sina.com.cn/s/blog_6849d1c201017mo7.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_6849d1c201017mo7.html</a></p>
<p>首先，我们要定义链接字符串和连接对象：</p>
<pre><code>// 连接字符串
string strConn = &quot;Initial Catalog=&apos;数据库名称&apos;;Server=&apos;127.0.0.1,1433&apos;;User ID=&apos;sa&apos;;Password=&apos;XXXXXX&apos;;Persist Security Info=True&quot;;
// SQL 连接对象
SqlConnection Connection = new SqlConnection(strConn);
</code></pre><p>这里不对连接字符串做更多解释了。</p>
<h1 id="一，增加新纪录"><a href="#一，增加新纪录" class="headerlink" title="一，增加新纪录"></a>一，增加新纪录</h1><pre><code>string strSQL = &quot;insert into TSchool values(&apos;TEST&apos;,&apos;&apos;)&quot;;
    SqlHelper.ExecuteNonQuery(strConn, CommandType.Text, strSQL);
</code></pre><p>插入成功。<br>这里我们调用了这个接口：</p>
<pre><code>public static int ExecuteNonQuery(string connectionString, // 连接字符串
  CommandType commandType, // 命令类型，CommandType.Text表示传入的参数是SQL语句
  string commandText // SQL语句
 )
</code></pre><p>返回值是被修改的记录个数。</p>
<h1 id="二，删除记录"><a href="#二，删除记录" class="headerlink" title="二，删除记录"></a>二，删除记录</h1><pre><code>string strSQL = &quot;delete from TSchool where Id=25&quot;;
SqlHelper.ExecuteNonQuery(strConn, CommandType.Text, strSQL);
</code></pre><p>调用同样的方法，只要会写SQL语句，完全没有难度啊。</p>
<h1 id="三，修改记录"><a href="#三，修改记录" class="headerlink" title="三，修改记录"></a>三，修改记录</h1><pre><code>string strSQL = &quot;update TSchool set Name=123 where Id=26&quot;;
SqlHelper.ExecuteNonQuery(strConn, CommandType.Text, strSQL);
</code></pre><p>依然只是SQL的变化。</p>
<h1 id="四，查找记录"><a href="#四，查找记录" class="headerlink" title="四，查找记录"></a>四，查找记录</h1><pre><code>string strSQL = &quot;select * from TSchool&quot;;
SqlDataReader read = SqlHelper.ExecuteReader(strConn, CommandType.Text, strSQL);

while (read.Read())
{
    string str0 = read[0].ToString();
    string str1 = read[1].ToString();
    Console.WriteLine(&quot;{0}__{1}&quot;, str0, str1);
}
</code></pre><p>这里调用了另外一个方法：</p>
<pre><code>public static SqlDataReader ExecuteReader(string connectionString, 
  CommandType commandType, 
    string commandText
)
</code></pre><p>参数和之前的ExecuteNonQuery相同，只不过返回值是一个SqlDataReader对象，用来获得结果集。</p>
<p>OK，就是这么简单。如有问题，欢迎提出探讨。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/LinkOracle.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/LinkOracle.html" itemprop="url">
                  CSharp连接Oracle方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:08:28+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSharp/" itemprop="url" rel="index">
                    <span itemprop="name">CSharp</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先，要在本机安装Oracle为VS2010提供的访问程序。从下面路径下载：<br><a href="http://www.oracle.com/technetwork/articles/dotnet/vs2010-oracle-dev-410461.html" target="_blank" rel="external">http://www.oracle.com/technetwork/articles/dotnet/vs2010-oracle-dev-410461.html</a></p>
<p>安装了Oracle Client端程序后，重启VS2010.</p>
<p>在VS2010中，引入Oracle访问库，如图：<br><img src="http://i2.piimg.com/612ba597c1212226.png" alt="VS2010下C#连接远端Oracle数据库方法"></p>
<p>之后可以在程序中做如下测试：</p>
<pre><code>string strConn = &quot;Data Source=127.0.0.1/bxcorcl;User ID=examtitlebanktw;PassWord=bestabxcexamtitlebankrd02&quot;;

string strSQL = &quot;SELECT * FROM IMAGE&quot;;

OracleConnection myConnection = new OracleConnection(strConn);

OracleCommand myORACCommand = myConnection.CreateCommand();

myORACCommand.CommandText = strSQL;

myConnection.Open();

OracleDataReader myDataReader = myORACCommand.ExecuteReader();

while (myDataReader.Read())
{
      Console.WriteLine(&quot;LINE: &quot; + myDataReader[0]);
}

myDataReader.Close();
myConnection.Close();
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://breakerthb.github.io/2017/03/18/CRC32.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天花板">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天花板的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/CRC32.html" itemprop="url">
                  CRC32
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T06:06:25+00:00">
                2017-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CRC32是最基础的计算CheckSum值得方法。如果出现重复，可以考虑用CRC64或MD5方法。</p>
<pre><code>const ULONG g_crc32_table[] =
{
    0x0, 0x77073096, 0xee0e612c, 0x990951ba, 0x76dc419,
    0x706af48f, 0xe963a535, 0x9e6495a3, 0xedb8832, 0x79dcb8a4,
    0xe0d5e91e, 0x97d2d988, 0x9b64c2b, 0x7eb17cbd, 0xe7b82d07,
    0x90bf1d91, 0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de,
    0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7, 0x136c9856,
    0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 0x14015c4f, 0x63066cd9,
    0xfa0f3d63, 0x8d080df5, 0x3b6e20c8, 0x4c69105e, 0xd56041e4,
    0xa2677172, 0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b,
    0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 0x32d86ce3,
    0x45df5c75, 0xdcd60dcf, 0xabd13d59, 0x26d930ac, 0x51de003a,
    0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423, 0xcfba9599,
    0xb8bda50f, 0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924,
    0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d, 0x76dc4190,
    0x1db7106, 0x98d220bc, 0xefd5102a, 0x71b18589, 0x6b6b51f,
    0x9fbfe4a5, 0xe8b8d433, 0x7807c9a2, 0xf00f934, 0x9609a88e,
    0xe10e9818, 0x7f6a0dbb, 0x86d3d2d, 0x91646c97, 0xe6635c01,
    0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e, 0x6c0695ed,
    0x1b01a57b, 0x8208f4c1, 0xf50fc457, 0x65b0d9c6, 0x12b7e950,
    0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3,
    0xfbd44c65, 0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2,
    0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb, 0x4369e96a,
    0x346ed9fc, 0xad678846, 0xda60b8d0, 0x44042d73, 0x33031de5,
    0xaa0a4c5f, 0xdd0d7cc9, 0x5005713c, 0x270241aa, 0xbe0b1010,
    0xc90c2086, 0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,
    0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17,
    0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad, 0xedb88320, 0x9abfb3b6,
    0x3b6e20c, 0x74b1d29a, 0xead54739, 0x9dd277af, 0x4db2615,
    0x73dc1683, 0xe3630b12, 0x94643b84, 0xd6d6a3e, 0x7a6a5aa8,
    0xe40ecf0b, 0x9309ff9d, 0xa00ae27, 0x7d079eb1, 0xf00f9344,
    0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb,
    0x196c3671, 0x6e6b06e7, 0xfed41b76, 0x89d32be0, 0x10da7a5a,
    0x67dd4acc, 0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5,
    0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252, 0xd1bb67f1,
    0xa6bc5767, 0x3fb506dd, 0x48b2364b, 0xd80d2bda, 0xaf0a1b4c,
    0x36034af6, 0x41047a60, 0xdf60efc3, 0xa867df55, 0x316e8eef,
    0x4669be79, 0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236,
    0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f, 0xc5ba3bbe,
    0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7, 0xb5d0cf31,
    0x2cd99e8b, 0x5bdeae1d, 0x9b64c2b0, 0xec63f226, 0x756aa39c,
    0x26d930a, 0x9c0906a9, 0xeb0e363f, 0x72076785, 0x5005713,
    0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0xcb61b38, 0x92d28e9b,
    0xe5d5be0d, 0x7cdcefb7, 0xbdbdf21, 0x86d3d2d4, 0xf1d4e242,
    0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1,
    0x18b74777, 0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c,
    0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45, 0xa00ae278,
    0xd70dd2ee, 0x4e048354, 0x3903b3c2, 0xa7672661, 0xd06016f7,
    0x4969474d, 0x3e6e77db, 0xaed16a4a, 0xd9d65adc, 0x40df0b66,
    0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,
    0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 0xbad03605,
    0xcdd70693, 0x54de5729, 0x23d967bf, 0xb3667a2e, 0xc4614ab8,
    0x5d681b02, 0x2a6f2b94, 0xb40bbe37, 0xc30c8ea1, 0x5a05df1b,
    0x2d02ef8d
};

WORD ReadSys_GetChecksum(BYTE* PData, int DataSize)
{
    int i;
    WORD CheckSum;
    CheckSum=0;
    i = DataSize;
    while(i--)
    {
        CheckSum+=(WORD)(*(PData++));      
    }

    return CheckSum;
}

ULONG ReadSys_GetCRC32(BYTE *PData, USHORT DataSize)
{
    // Be sure to use unsigned variables,
    // because negative values introduce high bits
    // where zero bits are required.
    int i;
    WORD CheckSum;
    BYTE* PBuffer;
    DWORD  crc;
    CheckSum = ReadSys_GetChecksum(PData,DataSize);

    crc = 0ffffffff;
    crc = (crc &gt;&gt; 8) ^ g_crc32_table[ (crc &amp; 0xFF)^DataSize];
    i = DataSize;
    PBuffer=PData;
    while(i--)
    {
        crc = (crc &gt;&gt; 8) ^ g_crc32_table[(crc &amp; 0xFF) ^ *PBuffer];
        PBuffer++;
    }

    crc = (crc &gt;&gt; 8) ^ g_crc32_table[ (crc &amp; 0xFF)^(CheckSum&gt;&gt;8)];
    crc = (crc &gt;&gt; 8) ^ g_crc32_table[ (crc &amp; 0xFF)^(CheckSum&amp;&amp;0xff)];

    //經過驗證,使用Checksum參與CRC32,仍然確保CRC32唯一.
    //直接返回crc,不需要返回crc^0xfffffffff.
    return crc; 
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="天花板" />
          <p class="site-author-name" itemprop="name">天花板</p>
           
              <p class="site-description motion-element" itemprop="description">Do not give up unless you die</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/breakerthb" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/your-user-name" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/u/9202155c8b4a" title="简书" target="_blank">简书</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">天花板</span>
</div>

<!-- 
<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
 -->

<!-- 
&nbsp;&nbsp;|&nbsp;&nbsp;
  <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' type='text/javascript'%3E%3C/script%3E"));
  </script>

  &nbsp;&nbsp;|&nbsp;&nbsp;<span><a href="/sitemap.xml">Google网站地图</a></span>
  &nbsp;&nbsp;|&nbsp;&nbsp;<span><a href="/baidusitemap.xml">百度网站地图</a></span>

  </span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


&nbsp;&nbsp;|&nbsp;&nbsp;本站总点击 <span id="busuanzi_value_site_pv"></span> 次
&nbsp;&nbsp;|&nbsp;&nbsp;您是第 <span id="busuanzi_value_site_uv"></span> 位访客

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

 -->

        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
